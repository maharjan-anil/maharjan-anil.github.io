<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Nexus Video Library</title>
<link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark: #030305;
  --bg-card: #0d0d12;
  --bg-card-hover: #12121a;
  --bg-glass: rgba(13, 13, 18, 0.85);
  --border-subtle: rgba(255, 255, 255, 0.06);
  --border-accent: rgba(124, 58, 237, 0.3);
  --text-primary: #ffffff;
  --text-secondary: #a1a1aa;
  --text-muted: #71717a;
  --accent-purple: #7c3aed;
  --accent-blue: #3b82f6;
  --accent-cyan: #06b6d4;
  --accent-pink: #ec4899;
  --accent-orange: #f97316;
  --accent-green: #10b981;
  --accent-red: #ef4444;
  --gradient-primary: linear-gradient(135deg, #7c3aed 0%, #3b82f6 50%, #06b6d4 100%);
  --gradient-glow: radial-gradient(ellipse at center, rgba(124, 58, 237, 0.15) 0%, transparent 70%);
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
  --shadow-glow: 0 0 40px rgba(124, 58, 237, 0.2);
  --radius-sm: 6px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg-dark);
  color: var(--text-primary);
  min-height: 100vh;
  line-height: 1.6;
  overflow-x: hidden;
  position: relative;
}

/* Animated Background Mesh */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(ellipse at 15% 25%, rgba(124, 58, 237, 0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 85% 75%, rgba(59, 130, 246, 0.06) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 50%, rgba(6, 182, 212, 0.04) 0%, transparent 60%);
  pointer-events: none;
  z-index: -1;
  animation: meshPulse 8s ease-in-out infinite;
}

@keyframes meshPulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.02); }
}

/* Floating Particles */
.particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -1;
  overflow: hidden;
}

.particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: var(--accent-purple);
  border-radius: 50%;
  opacity: 0.3;
  animation: float 20s infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
  10% { opacity: 0.3; }
  90% { opacity: 0.3; }
  100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
}

/* Header - Futuristic Design */
.header {
  background: var(--bg-glass);
  backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--border-subtle);
  padding: 1.25rem 3rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow-md);
}

.header h1 {
  font-family: 'Space Grotesk', sans-serif;
  font-weight: 700;
  font-size: 1.85rem;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  cursor: pointer;
  flex: 1;
  text-align: center;
  letter-spacing: -0.5px;
  transition: all 0.4s var(--transition-smooth);
  position: relative;
}

.header h1::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 2px;
  background: var(--gradient-primary);
  transition: width 0.4s var(--transition-smooth);
}

.header h1:hover::after {
  width: 80px;
}

.header h1:hover {
  transform: scale(1.02);
  text-shadow: 0 0 30px rgba(124, 58, 237, 0.5);
}

.header h1 i {
  margin-right: 0.75rem;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Neon Buttons */
.admin-btn {
  background: transparent;
  color: var(--text-primary);
  border: 1px solid var(--border-accent);
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius-md);
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.4s var(--transition-smooth);
  position: relative;
  overflow: hidden;
  font-family: 'Space Grotesk', sans-serif;
}

.admin-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--gradient-primary);
  opacity: 0;
  transition: opacity 0.4s var(--transition-smooth);
  z-index: -1;
}

.admin-btn:hover::before {
  opacity: 1;
}

.admin-btn:hover {
  border-color: transparent;
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
}

.admin-btn i {
  transition: transform 0.4s var(--transition-smooth);
}

.admin-btn:hover i {
  transform: rotate(90deg);
}

.admin-btn.logout {
  border-color: rgba(239, 68, 68, 0.5);
}

.admin-btn.logout::before {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

.admin-btn.logout:hover {
  box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);
}

.user-info {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.9rem;
  color: var(--text-secondary);
  background: var(--bg-card);
  padding: 0.5rem 1.25rem;
  border-radius: var(--radius-md);
  border: 1px solid var(--border-subtle);
  font-family: 'Space Grotesk', sans-serif;
}

.user-info i {
  color: var(--accent-cyan);
  font-size: 1.1rem;
}

/* Filters - Modern Pill Design */
.filters {
  padding: 2rem 3rem;
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  align-items: center;
  background: var(--bg-card);
  border-bottom: 1px solid var(--border-subtle);
}

.filters select, .filters input {
  padding: 0.875rem 1.5rem;
  border-radius: 50px;
  border: 1px solid var(--border-subtle);
  background: var(--bg-dark);
  color: var(--text-primary);
  font-size: 0.9rem;
  font-weight: 500;
  min-width: 180px;
  transition: all 0.3s var(--transition-smooth);
  outline: none;
  font-family: 'Inter', sans-serif;
}

.filters select:focus, .filters input:focus {
  border-color: var(--accent-purple);
  box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.15);
  background: var(--bg-card-hover);
}

.filters input::placeholder {
  color: var(--text-muted);
}

.filters input {
  flex: 1;
  max-width: 400px;
}

.filters select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a1a1aa' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  padding-right: 3rem;
}

/* Video Grid - Asymmetric Layout */
.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 2.5rem;
  padding: 3rem;
  position: relative;
}

/* Unique Video Card Design */
.video-card {
  background: var(--bg-card);
  border-radius: var(--radius-xl);
  overflow: hidden;
  border: 1px solid var(--border-subtle);
  transition: all 0.5s var(--transition-smooth);
  cursor: pointer;
  position: relative;
}

.video-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--gradient-primary);
  opacity: 0;
  transition: opacity 0.5s var(--transition-smooth);
  pointer-events: none;
  z-index: 1;
}

.video-card::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: conic-gradient(from 0deg, transparent, rgba(124, 58, 237, 0.1), transparent 30%);
  animation: rotate 4s linear infinite;
  opacity: 0;
  transition: opacity 0.5s var(--transition-smooth);
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.video-card:hover {
  transform: translateY(-12px) scale(1.02);
  box-shadow: var(--shadow-lg), var(--shadow-glow);
  border-color: var(--border-accent);
}

.video-card:hover::before {
  opacity: 0.05;
}

.video-card:hover::after {
  opacity: 1;
}

.card-thumb {
  width: 100%;
  height: 220px;
  background: var(--bg-dark);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

.card-thumb::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.6) 100%);
  z-index: 2;
}

.card-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: none;
  transition: transform 0.6s var(--transition-smooth);
}

.video-card:hover .card-thumb img.loaded {
  transform: scale(1.1);
}

.card-thumb img.loaded {
  display: block;
}

.card-thumb .placeholder {
  color: var(--text-muted);
  font-size: 5rem;
  z-index: 3;
  transition: all 0.5s var(--transition-smooth);
  position: relative;
}

.video-card:hover .card-thumb .placeholder {
  transform: scale(1.15) rotate(5deg);
  color: var(--accent-purple);
  text-shadow: 0 0 30px rgba(124, 58, 237, 0.5);
}

/* Corner Accent */
.card-thumb::after {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 80px;
  height: 80px;
  background: var(--gradient-primary);
  clip-path: polygon(100% 0, 0 0, 100% 100%);
  opacity: 0;
  transition: opacity 0.5s var(--transition-smooth);
  z-index: 4;
}

.video-card:hover .card-thumb::after {
  opacity: 0.8;
}

/* Type Badge - HIDDEN BY DEFAULT, SHOW ON HOVER */
.type-badge {
  position: absolute;
  bottom: 12px;
  left: 12px;
  padding: 0.5rem 1.25rem;
  border-radius: 50px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  z-index: 5;
  backdrop-filter: blur(10px);
  font-family: 'Space Grotesk', sans-serif;
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.4s var(--transition-smooth);
  pointer-events: none;
}

.video-card:hover .type-badge {
  opacity: 1;
  transform: translateY(0);
}

.type-youtube { background: linear-gradient(135deg, rgba(239, 68, 68, 0.95) 0%, rgba(220, 38, 38, 0.95) 100%); }
.type-drive { background: linear-gradient(135deg, rgba(59, 130, 246, 0.95) 0%, rgba(37, 99, 235, 0.95) 100%); }
.type-pdf { background: linear-gradient(135deg, rgba(234, 88, 12, 0.95) 0%, rgba(194, 65, 12, 0.95) 100%); }
.type-playlist { background: linear-gradient(135deg, rgba(124, 58, 237, 0.95) 0%, rgba(99, 102, 241, 0.95) 100%); }

/* Protected Badge - Holographic */
.protected-badge {
  position: absolute;
  top: 16px;
  right: 16px;
  background: linear-gradient(135deg, rgba(245, 158, 11, 0.9) 0%, rgba(234, 88, 12, 0.9) 100%);
  backdrop-filter: blur(10px);
  color: white;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  z-index: 10;
  box-shadow: 0 4px 16px rgba(245, 158, 11, 0.4);
  border: 2px solid rgba(255, 255, 255, 0.1);
  transition: all 0.4s var(--transition-smooth);
}

.video-card:hover .protected-badge {
  transform: scale(1.1) rotate(10deg);
  box-shadow: 0 6px 24px rgba(245, 158, 11, 0.6);
}

/* Admin Actions - Floating */
.admin-actions {
  position: absolute;
  top: 16px;
  left: 16px;
  display: flex;
  gap: 10px;
  z-index: 10;
  opacity: 0;
  transform: translateY(-15px);
  transition: all 0.4s var(--transition-smooth);
}

.video-card:hover .admin-actions {
  opacity: 1;
  transform: translateY(0);
}

.admin-btn-action {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-md);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.95rem;
  color: white;
  transition: all 0.3s var(--transition-smooth);
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow-md);
}

.admin-btn-action:hover {
  transform: scale(1.2) rotate(5deg);
}

.delete-btn {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.9) 0%, rgba(220, 38, 38, 0.9) 100%);
}

.delete-btn:hover {
  box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
}

.edit-btn {
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.9) 0%, rgba(59, 130, 246, 0.9) 100%);
}

.edit-btn:hover {
  box-shadow: 0 6px 20px rgba(124, 58, 237, 0.5);
}

.card-content {
  padding: 1.75rem;
  position: relative;
  z-index: 2;
}

.card-title {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 1.15rem;
  font-weight: 600;
  margin-bottom: 0.875rem;
  color: var(--text-primary);
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  text-overflow: ellipsis;
  line-height: 1.4;
  transition: color 0.3s var(--transition-smooth);
}

.video-card:hover .card-title {
  color: var(--accent-cyan);
}

.card-meta {
  font-size: 0.85rem;
  color: var(--text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.card-meta::before {
  content: '';
  width: 6px;
  height: 6px;
  background: var(--accent-purple);
  border-radius: 50%;
  flex-shrink: 0;
}

/* Pagination - Unique Design */
.pagination {
  padding: 2.5rem 3rem;
  display: flex;
  justify-content: center;
  gap: 0.875rem;
}

.pagination button {
  padding: 0.875rem 1.5rem;
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  color: var(--text-secondary);
  border-radius: var(--radius-md);
  cursor: pointer;
  font-weight: 600;
  font-family: 'Space Grotesk', sans-serif;
  transition: all 0.3s var(--transition-smooth);
  position: relative;
  overflow: hidden;
}

.pagination button::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--gradient-primary);
  opacity: 0;
  transition: opacity 0.3s var(--transition-smooth);
}

.pagination button:hover:not(:disabled)::before {
  opacity: 1;
}

.pagination button:hover:not(:disabled) {
  color: white;
  border-color: transparent;
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(124, 58, 237, 0.3);
}

.pagination button.active {
  background: var(--gradient-primary);
  color: white;
  border-color: transparent;
  box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
}

.pagination button:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

/* Video Popup Modal - Cinematic */
#videoPopupModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.97);
  backdrop-filter: blur(15px);
  z-index: 3000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 2rem;
  box-sizing: border-box;
  animation: fadeIn 0.4s var(--transition-smooth);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

#popupControls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 90%;
  max-width: 1100px;
  margin-bottom: 2rem;
  opacity: 0;
  transition: opacity 0.4s var(--transition-smooth);
}

#videoPopupModal:hover #popupControls {
  opacity: 1;
}

#popupTitle {
  font-family: 'Space Grotesk', sans-serif;
  color: var(--text-primary);
  font-size: 1.5rem;
  font-weight: 600;
  text-align: center;
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 0 1.5rem;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

#backToListBtn, #closePopup {
  background: var(--bg-card);
  color: var(--text-primary);
  border: 1px solid var(--border-subtle);
  width: 50px;
  height: 50px;
  border-radius: 50%;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s var(--transition-smooth);
  backdrop-filter: blur(10px);
  font-size: 1.2rem;
}

#backToListBtn:hover, #closePopup:hover {
  background: var(--bg-card-hover);
  border-color: var(--accent-purple);
  transform: scale(1.15) rotate(5deg);
  box-shadow: 0 6px 20px rgba(124, 58, 237, 0.3);
}

#popupVideoFrame {
  width: 90%;
  max-width: 1100px;
  height: 56.25vw;
  max-height: 60vh;
  border: none;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-lg), 0 0 60px rgba(124, 58, 237, 0.2);
}

/* Password Modal - Secure Vault Design */
#passwordModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(12px);
  z-index: 2000;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.4s var(--transition-smooth);
}

#passwordModal .modal-content {
  background: linear-gradient(145deg, var(--bg-card) 0%, var(--bg-dark) 100%);
  backdrop-filter: blur(20px) saturate(180%);
  padding: 3rem;
  border-radius: var(--radius-xl);
  width: 90%;
  max-width: 480px;
  box-shadow: var(--shadow-lg), 0 0 60px rgba(124, 58, 237, 0.2);
  border: 1px solid var(--border-accent);
  color: var(--text-primary);
  animation: slideUp 0.5s var(--transition-smooth);
  position: relative;
  overflow: hidden;
}

#passwordModal .modal-content::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: conic-gradient(from 0deg, transparent, rgba(124, 58, 237, 0.05), transparent 30%);
  animation: rotate 10s linear infinite;
  pointer-events: none;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(40px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

#passwordModal h5 {
  font-family: 'Space Grotesk', sans-serif;
  font-weight: 600;
  margin-bottom: 2rem;
  color: var(--text-primary);
  font-size: 1.5rem;
  text-align: center;
  position: relative;
  z-index: 1;
}

#passwordModal .form-control {
  background: var(--bg-dark);
  border: 1px solid var(--border-subtle);
  color: var(--text-primary);
  padding: 1rem 1.5rem;
  border-radius: var(--radius-md);
  font-size: 1rem;
  transition: all 0.3s var(--transition-smooth);
  font-family: 'Inter', sans-serif;
  position: relative;
  z-index: 1;
}

#passwordModal .form-control:focus {
  border-color: var(--accent-purple);
  box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.15);
  background: var(--bg-card-hover);
  color: var(--text-primary);
}

#passwordError {
  display: none;
  color: var(--accent-red);
  font-size: 0.9rem;
  margin-top: 1rem;
  padding: 1rem;
  background: rgba(239, 68, 68, 0.1);
  border-radius: var(--radius-md);
  border: 1px solid rgba(239, 68, 68, 0.2);
  text-align: center;
  position: relative;
  z-index: 1;
}

/* All Modals - Consistent Futuristic Design */
#addVideoModal, #editVideoModal, #authModal, #settingsModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(12px);
  z-index: 4000;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.4s var(--transition-smooth);
}

#addVideoModal .modal-content,
#editVideoModal .modal-content,
#authModal .modal-content,
#settingsModal .modal-content {
  background: linear-gradient(145deg, var(--bg-card) 0%, var(--bg-dark) 100%);
  backdrop-filter: blur(20px) saturate(180%);
  padding: 3rem;
  border-radius: var(--radius-xl);
  width: 90%;
  max-width: 600px;
  box-shadow: var(--shadow-lg), 0 0 80px rgba(124, 58, 237, 0.2);
  border: 1px solid var(--border-accent);
  color: var(--text-primary);
  max-height: 90vh;
  overflow-y: auto;
  animation: slideUp 0.5s var(--transition-smooth);
  position: relative;
}

.modal-content h5 {
  font-family: 'Space Grotesk', sans-serif;
  font-weight: 600;
  margin-bottom: 2.5rem;
  font-size: 1.65rem;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-align: center;
}

.modal-content .form-label {
  color: var(--text-secondary);
  font-size: 0.9rem;
  font-weight: 500;
  margin-bottom: 0.75rem;
  font-family: 'Space Grotesk', sans-serif;
}

.modal-content .form-control,
.modal-content .form-select {
  background: var(--bg-dark);
  border: 1px solid var(--border-subtle);
  color: var(--text-primary);
  padding: 1rem 1.5rem;
  border-radius: var(--radius-md);
  font-size: 0.95rem;
  transition: all 0.3s var(--transition-smooth);
  margin-bottom: 0.5rem;
  font-family: 'Inter', sans-serif;
}

.modal-content .form-control:focus,
.modal-content .form-select:focus {
  border-color: var(--accent-purple);
  box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.15);
  background: var(--bg-card-hover);
  color: var(--text-primary);
}

.modal-content .form-select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a1a1aa' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1.25rem center;
  padding-right: 3.5rem;
}

.modal-content .form-check {
  padding: 1.25rem;
  background: var(--bg-dark);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-subtle);
  margin-top: 0.75rem;
  transition: all 0.3s var(--transition-smooth);
}

.modal-content .form-check:hover {
  border-color: var(--border-accent);
  background: var(--bg-card-hover);
}

.modal-content .form-check-input {
  width: 1.4rem;
  height: 1.4rem;
  background-color: var(--bg-dark);
  border: 1px solid var(--border-subtle);
  cursor: pointer;
}

.modal-content .form-check-input:checked {
  background-color: var(--accent-purple);
  border-color: var(--accent-purple);
  box-shadow: 0 0 10px rgba(124, 58, 237, 0.5);
}

.modal-content .form-check-label {
  color: var(--text-secondary);
  margin-left: 0.75rem;
  font-weight: 500;
  cursor: pointer;
  font-family: 'Space Grotesk', sans-serif;
}

#addVideoStatus, #editVideoStatus, #settingsStatus {
  margin-top: 2rem;
  font-size: 0.95rem;
  font-weight: 500;
  padding: 1.25rem;
  border-radius: var(--radius-md);
  text-align: center;
  font-family: 'Space Grotesk', sans-serif;
}

.status-success {
  color: var(--accent-green);
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.2);
}

.status-error {
  color: var(--accent-red);
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.2);
}

/* Modern Buttons in Modals */
.modal-content .btn {
  padding: 1rem 2.5rem;
  border-radius: var(--radius-md);
  font-weight: 600;
  transition: all 0.3s var(--transition-smooth);
  font-family: 'Space Grotesk', sans-serif;
  position: relative;
  overflow: hidden;
}

.modal-content .btn-primary {
  background: var(--gradient-primary);
  border: none;
  box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
}

.modal-content .btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(124, 58, 237, 0.4);
}

.modal-content .btn-secondary {
  background: var(--bg-dark);
  border: 1px solid var(--border-subtle);
  color: var(--text-primary);
}

.modal-content .btn-secondary:hover {
  background: var(--bg-card-hover);
  border-color: var(--accent-purple);
  transform: translateY(-2px);
}

/* Scrollbar Styling - Futuristic */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: var(--bg-dark);
}

::-webkit-scrollbar-thumb {
  background: var(--border-subtle);
  border-radius: 5px;
  transition: background 0.3s var(--transition-smooth);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-purple);
}

/* Responsive Design */
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    gap: 1.25rem;
    padding: 1.25rem 1.5rem;
  }
  
  .filters {
    flex-direction: column;
    align-items: stretch;
    padding: 1.5rem;
  }
  
  .filters select, .filters input {
    min-width: auto;
    width: 100%;
  }
  
  .video-grid {
    grid-template-columns: 1fr;
    padding: 1.5rem;
    gap: 2rem;
  }
  
  .pagination {
    padding: 1.5rem;
    flex-wrap: wrap;
  }
  
  #popupVideoFrame {
    height: 45vh;
  }
  
  .modal-content {
    padding: 2rem;
  }
}

/* Loading Animation */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

.loading {
  animation: pulse 2s var(--transition-smooth) infinite;
}

/* Empty State - Modern */
.empty-state {
  text-align: center;
  padding: 5rem 2rem;
  color: var(--text-muted);
}

.empty-state i {
  font-size: 5rem;
  margin-bottom: 1.5rem;
  opacity: 0.3;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.empty-state p {
  font-size: 1.2rem;
  font-family: 'Space Grotesk', sans-serif;
}

/* Glow Effect on Cards */
.video-card .glow-effect {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 200px;
  height: 200px;
  background: var(--accent-purple);
  border-radius: 50%;
  filter: blur(80px);
  opacity: 0;
  transition: opacity 0.5s var(--transition-smooth);
  pointer-events: none;
}

.video-card:hover .glow-effect {
  opacity: 0.3;
}
</style>
</head>
<body>
<!-- Floating Particles -->
<div class="particles" id="particles"></div>

<div class="header">
<div style="display: flex; align-items: center; gap: 1rem;">
<button id="adminBtn" class="admin-btn" style="display: none;">
<i class="fas fa-plus"></i> Add Video
</button>
<button id="settingsBtn" class="admin-btn" style="display: none;">
<i class="fas fa-cog"></i> Settings
</button>
<button id="authBtn" class="admin-btn">
<i class="fas fa-sign-in-alt"></i> Admin Login
</button>
</div>
<h1 id="headerTitle"><i class="fa-solid fa-video"></i>NEXUS LIBRARY</h1>
<div class="user-info" id="userInfo" style="display: none;">
<i class="fas fa-user-circle"></i>
<span id="userEmail"></span>
</div>
</div>

<div class="filters">
<select id="categoryFilter"><option value="">All Categories</option></select>
<select id="subcategoryFilter"><option value="">All Subcategories</option></select>
<select id="topicFilter"><option value="">All Topics</option></select>
<input type="text" id="searchBox" placeholder="Search videos..." autocomplete="off">
</div>

<div class="video-grid" id="videoGrid"><div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Loading library...</p></div></div>

<div class="pagination" id="pagination"></div>

<!-- Popup Video Modal -->
<div id="videoPopupModal">
<div id="popupControls">
<button id="backToListBtn" title="Back to list"><i class="fas fa-arrow-left"></i></button>
<div id="popupTitle"></div>
<button id="closePopup" title="Close"><i class="fas fa-times"></i></button>
</div>
<iframe id="popupVideoFrame" allowfullscreen></iframe>
</div>

<!-- Password Modal -->
<div id="passwordModal">
<div class="modal-content">
<h5><i class="fas fa-lock me-2"></i>Secure Access</h5>
<input type="password" id="videoPassword" class="form-control" placeholder="Enter access code" autocomplete="off">
<p id="passwordError"><i class="fas fa-exclamation-triangle me-2"></i>Incorrect password. Please try again.</p>
<div class="d-flex justify-content-between mt-4">
<button id="cancelPassword" class="btn btn-secondary btn-sm">Cancel</button>
<button id="submitPassword" class="btn btn-primary btn-sm">Unlock</button>
</div>
</div>
</div>

<!-- Add Video Modal -->
<div id="addVideoModal">
<div class="modal-content">
<h5><i class="fas fa-upload me-2"></i>Add New Video</h5>
<form id="addVideoForm">
<div class="mb-3">
<label class="form-label">Title</label>
<input type="text" id="newTitle" class="form-control" required placeholder="Enter video title">
</div>
<div class="mb-3">
<label class="form-label">Type</label>
<select id="newType" class="form-select" required>
<option value="youtube">YouTube</option>
<option value="drive">Google Drive</option>
<option value="pdf">PDF</option>
<option value="youtube-playlist">YouTube Playlist</option>
</select>
</div>
<div class="mb-3">
<label class="form-label">ID / URL</label>
<input type="text" id="newId" class="form-control" placeholder="Drive ID or YouTube URL" required>
</div>
<div class="mb-3" id="newFirstVideoIdGroup" style="display:none;">
<label class="form-label"><i class="fas fa-film me-2"></i>First Video ID (for Thumbnail)</label>
<input type="text" id="newFirstVideoId" class="form-control" placeholder="e.g., dQw4w9WgXcQ">
<small class="text-muted" style="font-size:0.75rem; color: var(--text-muted); display: block; margin-top: 0.5rem;">
<i class="fas fa-info-circle me-1"></i>Enter the ID of the first video to display as the playlist thumbnail.
</small>
</div>
<div class="mb-3">
<label class="form-label">Category</label>
<input type="text" id="newCategory" class="form-control" list="categoryList" required placeholder="Enter category">
<datalist id="categoryList"></datalist>
</div>
<div class="mb-3">
<label class="form-label">Subcategory</label>
<input type="text" id="newSubcategory" class="form-control" list="subcategoryList" placeholder="Enter subcategory">
<datalist id="subcategoryList"></datalist>
</div>
<div class="mb-3">
<label class="form-label">Topic</label>
<input type="text" id="newTopic" class="form-control" list="topicList" placeholder="Enter topic">
<datalist id="topicList"></datalist>
</div>
<div class="mb-4 form-check">
<input type="checkbox" class="form-check-input" id="newProtected">
<label class="form-check-label" for="newProtected"><i class="fas fa-lock me-2"></i>Password Protected</label>
</div>
<div id="addVideoStatus"></div>
<div class="d-flex justify-content-between mt-4">
<button type="button" id="cancelAddVideo" class="btn btn-secondary btn-sm">Cancel</button>
<button type="submit" class="btn btn-primary btn-sm">Save Video</button>
</div>
</form>
</div>
</div>

<!-- Edit Video Modal -->
<div id="editVideoModal">
<div class="modal-content">
<h5><i class="fas fa-edit me-2"></i>Edit Video</h5>
<form id="editVideoForm">
<input type="hidden" id="editVideoId">
<div class="mb-3">
<label class="form-label">Title</label>
<input type="text" id="editTitle" class="form-control" required>
</div>
<div class="mb-3">
<label class="form-label">Type</label>
<select id="editType" class="form-select" required>
<option value="youtube">YouTube</option>
<option value="drive">Google Drive</option>
<option value="pdf">PDF</option>
<option value="youtube-playlist">YouTube Playlist</option>
</select>
</div>
<div class="mb-3">
<label class="form-label">ID / URL</label>
<input type="text" id="editId" class="form-control" required>
</div>
<div class="mb-3" id="editFirstVideoIdGroup" style="display:none;">
<label class="form-label"><i class="fas fa-film me-2"></i>First Video ID (for Thumbnail)</label>
<input type="text" id="editFirstVideoId" class="form-control" placeholder="e.g., dQw4w9WgXcQ">
</div>
<div class="mb-3">
<label class="form-label">Category</label>
<input type="text" id="editCategory" class="form-control" list="categoryList" required>
</div>
<div class="mb-3">
<label class="form-label">Subcategory</label>
<input type="text" id="editSubcategory" class="form-control" list="subcategoryList">
</div>
<div class="mb-3">
<label class="form-label">Topic</label>
<input type="text" id="editTopic" class="form-control" list="topicList">
</div>
<div class="mb-4 form-check">
<input type="checkbox" class="form-check-input" id="editProtected">
<label class="form-check-label" for="editProtected"><i class="fas fa-lock me-2"></i>Password Protected</label>
</div>
<div id="editVideoStatus"></div>
<div class="d-flex justify-content-between mt-4">
<button type="button" id="cancelEditVideo" class="btn btn-secondary btn-sm">Cancel</button>
<button type="submit" class="btn btn-primary btn-sm">Update Video</button>
</div>
</form>
</div>
</div>

<!-- Settings Modal -->
<div id="settingsModal">
<div class="modal-content">
<h5><i class="fas fa-cog me-2"></i>Security Settings</h5>
<form id="settingsForm">
<div class="mb-3">
<label class="form-label">Current Password Status</label>
<input type="text" id="currentVideoPassword" class="form-control" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" readonly style="cursor: not-allowed; opacity: 0.6;">
<small class="text-muted" style="font-size:0.75rem; color: var(--text-muted); display: block; margin-top: 0.5rem;">
<i class="fas fa-shield-alt me-1"></i> Current password is hidden for security
</small>
</div>
<div class="mb-3">
<label class="form-label">New Access Password</label>
<input type="text" id="newVideoPassword" class="form-control" placeholder="Enter new password" required>
<small class="text-muted" style="font-size:0.75rem; color: var(--text-muted); display: block; margin-top: 0.5rem;">
<i class="fas fa-key me-1"></i> This will be the new password for protected videos
</small>
</div>
<div class="mb-3">
<label class="form-label">Confirm New Password</label>
<input type="text" id="confirmVideoPassword" class="form-control" placeholder="Re-enter new password" required>
</div>
<div id="settingsStatus"></div>
<div class="d-flex justify-content-between mt-4">
<button type="button" id="cancelSettings" class="btn btn-secondary btn-sm">Cancel</button>
<button type="submit" class="btn btn-primary btn-sm">Update Password</button>
</div>
</form>
</div>
</div>

<!-- Auth Modal -->
<div id="authModal">
<div class="modal-content">
<h5 id="authTitle"><i class="fas fa-sign-in-alt me-2"></i>Admin Access</h5>
<form id="authForm">
<div class="mb-3">
<label class="form-label">Email</label>
<input type="email" id="authEmail" class="form-control" required placeholder="Enter your email">
</div>
<div class="mb-3">
<label class="form-label">Password</label>
<input type="password" id="authPassword" class="form-control" required placeholder="Enter your password">
</div>
<p id="authError"></p>
<div class="d-flex justify-content-between mt-4">
<button type="button" id="cancelAuth" class="btn btn-secondary btn-sm">Cancel</button>
<button type="submit" class="btn btn-primary btn-sm" id="authSubmitBtn">Login</button>
</div>
</form>
</div>
</div>

<!-- Firebase SDKs -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc, serverTimestamp, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

// ============================================
// ‚öôÔ∏è FIREBASE CONFIGURATION
// ============================================
const firebaseConfig = {
apiKey: "AIzaSyB82MwSrGp35eS2ZXBsBlhie6EL6s-5HK0",
authDomain: "videolibrary-4709d.firebaseapp.com",
projectId: "videolibrary-4709d",
storageBucket: "videolibrary-4709d.firebasestorage.app",
messagingSenderId: "752788156798",
appId: "1:752788156798:web:df6dc050abc7de4150432f"
};

let db, auth;
try {
const app = initializeApp(firebaseConfig);
db = getFirestore(app);
auth = getAuth(app);
console.log("‚úÖ Firebase initialized");
} catch (e) {
console.error("Firebase init error:", e);
document.getElementById('videoGrid').innerHTML = `<div style="grid-column:1/-1; text-align:center; color:#f87171;">Firebase Config Missing.</div>`;
}

// ============================================
// GLOBAL VARIABLES
// ============================================
const VIDEOS_PER_PAGE = 100;
let allVideos = [];
let filteredVideos = [];
let currentPage = 1;
let videoPassword = "Animator";
let currentUser = null;
let editingVideoId = null;
let currentVideo = null;

// ============================================
// DOM ELEMENTS
// ============================================
const categoryFilter = document.getElementById('categoryFilter');
const subcategoryFilter = document.getElementById('subcategoryFilter');
const topicFilter = document.getElementById('topicFilter');
const searchBox = document.getElementById('searchBox');
const videoGrid = document.getElementById('videoGrid');
const paginationEl = document.getElementById('pagination');
const popupModal = document.getElementById('videoPopupModal');
const popupFrame = document.getElementById('popupVideoFrame');
const popupTitle = document.getElementById('popupTitle');
const closePopup = document.getElementById('closePopup');
const backToListBtn = document.getElementById('backToListBtn');
const passwordModal = document.getElementById('passwordModal');
const videoPasswordInput = document.getElementById('videoPassword');
const submitPassword = document.getElementById('submitPassword');
const cancelPassword = document.getElementById('cancelPassword');
const passwordError = document.getElementById('passwordError');
const headerTitle = document.getElementById('headerTitle');
const adminBtn = document.getElementById('adminBtn');
const settingsBtn = document.getElementById('settingsBtn');
const authBtn = document.getElementById('authBtn');
const userInfo = document.getElementById('userInfo');
const userEmail = document.getElementById('userEmail');
const addVideoModal = document.getElementById('addVideoModal');
const addVideoForm = document.getElementById('addVideoForm');
const cancelAddVideo = document.getElementById('cancelAddVideo');
const addVideoStatus = document.getElementById('addVideoStatus');
const editVideoModal = document.getElementById('editVideoModal');
const editVideoForm = document.getElementById('editVideoForm');
const cancelEditVideo = document.getElementById('cancelEditVideo');
const editVideoStatus = document.getElementById('editVideoStatus');
const settingsModal = document.getElementById('settingsModal');
const settingsForm = document.getElementById('settingsForm');
const cancelSettings = document.getElementById('cancelSettings');
const settingsStatus = document.getElementById('settingsStatus');
const currentVideoPassword = document.getElementById('currentVideoPassword');
const newVideoPassword = document.getElementById('newVideoPassword');
const categoryList = document.getElementById('categoryList');
const subcategoryList = document.getElementById('subcategoryList');
const topicList = document.getElementById('topicList');
const authModal = document.getElementById('authModal');
const authForm = document.getElementById('authForm');
const authEmail = document.getElementById('authEmail');
const authPassword = document.getElementById('authPassword');
const authError = document.getElementById('authError');
const authSubmitBtn = document.getElementById('authSubmitBtn');
const cancelAuth = document.getElementById('cancelAuth');
const confirmVideoPassword = document.getElementById('confirmVideoPassword');

// First Video ID Elements
const newFirstVideoIdGroup = document.getElementById('newFirstVideoIdGroup');
const newFirstVideoId = document.getElementById('newFirstVideoId');
const editFirstVideoIdGroup = document.getElementById('editFirstVideoIdGroup');
const editFirstVideoId = document.getElementById('editFirstVideoId');
const newTypeSelect = document.getElementById('newType');
const editTypeSelect = document.getElementById('editType');

// ============================================
// CREATE FLOATING PARTICLES
// ============================================
function createParticles() {
const particlesContainer = document.getElementById('particles');
for (let i = 0; i < 30; i++) {
const particle = document.createElement('div');
particle.className = 'particle';
particle.style.left = Math.random() * 100 + '%';
particle.style.animationDelay = Math.random() * 20 + 's';
particle.style.animationDuration = (15 + Math.random() * 10) + 's';
particlesContainer.appendChild(particle);
}
}
createParticles();

// ============================================
// üîê LOAD VIDEO PASSWORD FROM FIREBASE
// ============================================
function loadVideoPassword() {
if (!db) return;
const passwordDoc = doc(db, "settings", "videoPassword");
onSnapshot(passwordDoc, (docSnap) => {
if (docSnap.exists()) {
videoPassword = docSnap.data().password || "Animator";
console.log("üîê Video password loaded from Firebase");
} else {
console.log("üîê Creating default video password document");
setDoc(passwordDoc, { password: "Animator", updatedAt: serverTimestamp() });
videoPassword = "Animator";
}
}, (error) => {
console.error("‚ùå Error loading video password:", error);
videoPassword = "Animator";
});
}

// ============================================
// AUTH STATE LISTENER
// ============================================
if (auth) {
onAuthStateChanged(auth, (user) => {
currentUser = user;
console.log("üîê Auth state changed:", user ? user.email : "Logged out");
if (user) {
adminBtn.style.display = 'flex';
settingsBtn.style.display = 'flex';
authBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
authBtn.classList.add('logout');
userInfo.style.display = 'flex';
userEmail.textContent = user.email;
} else {
adminBtn.style.display = 'none';
settingsBtn.style.display = 'none';
authBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Admin Login';
authBtn.classList.remove('logout');
userInfo.style.display = 'none';
}
renderVideos();
});
}

// ============================================
// FIREBASE DATA SYNC
// ============================================
if (db) {
const q = query(collection(db, "videos"), orderBy("createdAt", "desc"));
onSnapshot(q, (snapshot) => {
allVideos = snapshot.docs.map(doc => ({
firestoreId: doc.id,
...doc.data()
}));
console.log(`üìπ Loaded ${allVideos.length} videos from Firebase`);
updateDataLists();
populateFilters();
applyFilters();
}, (error) => {
console.error("‚ùå Error fetching videos:", error);
videoGrid.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:#f87171;">Error: ${error.message}</div>`;
});
}

loadVideoPassword();

// ============================================
// HELPER FUNCTIONS
// ============================================
function getYouTubeId(url) {
if(!url) return null;
const regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
const match = url.trim().match(regExp);
return (match && match[2].length === 11) ? match[2] : null;
}

function getThumbnailUrl(item) {
if (item.type === "youtube") {
const id = getYouTubeId(item.url || item.id);
return id ? `https://img.youtube.com/vi/${id}/mqdefault.jpg` : null;
} else if (item.type === "youtube-playlist") {
if (item.firstVideoId) {
return `https://img.youtube.com/vi/${item.firstVideoId}/mqdefault.jpg`;
}
return null;
} else if ((item.type === "drive" || item.type === "pdf") && item.id) {
return `https://drive.google.com/thumbnail?id=${item.id}&sz=w640`;
}
return null;
}

function getEmbedUrl(item) {
if (item.type === "youtube") {
const id = getYouTubeId(item.url || item.id);
return id ? `https://www.youtube.com/embed/${id}?autoplay=1` : null;
} else if (item.type === "youtube-playlist") {
return `https://www.youtube.com/embed/videoseries?list=${item.id}&autoplay=1`;
} else if ((item.type === "drive" || item.type === "pdf") && item.id) {
return `https://drive.google.com/file/d/${item.id}/preview`;
}
return null;
}

function getTypeBadge(type) {
const badges = {
'youtube': 'YouTube',
'drive': 'Drive',
'pdf': 'PDF',
'youtube-playlist': 'Playlist'
};
return badges[type] || 'Video';
}

function getTypeClass(type) {
const classes = {
'youtube': 'type-youtube',
'drive': 'type-drive',
'pdf': 'type-pdf',
'youtube-playlist': 'type-playlist'
};
return classes[type] || '';
}

function updateDataLists() {
const cats = [...new Set(allVideos.map(v => v.category).filter(Boolean))].sort();
const subs = [...new Set(allVideos.map(v => v.subcategory).filter(Boolean))].sort();
const tops = [...new Set(allVideos.map(v => v.topic).filter(Boolean))].sort();
categoryList.innerHTML = cats.map(c => `<option value="${c}">`).join('');
subcategoryList.innerHTML = subs.map(s => `<option value="${s}">`).join('');
topicList.innerHTML = tops.map(t => `<option value="${t}">`).join('');
}

function populateFilters() {
const cats = [...new Set(allVideos.map(v => (v.category || "Uncategorized").trim()))].sort();
const currentValue = categoryFilter.value;
categoryFilter.innerHTML = '<option value="">All Categories</option>';
cats.forEach(cat => {
if (cat && cat.trim()) {
const opt = document.createElement('option');
opt.value = cat.trim();
opt.textContent = cat.trim();
categoryFilter.appendChild(opt);
}
});
if (currentValue && cats.includes(currentValue)) {
categoryFilter.value = currentValue;
}
updateSubcategories();
}

function updateSubcategories() {
const cat = categoryFilter.value.trim();
const currentSubValue = subcategoryFilter.value;
subcategoryFilter.innerHTML = '<option value="">All Subcategories</option>';
topicFilter.innerHTML = '<option value="">All Topics</option>';
if (!cat) {
subcategoryFilter.value = '';
topicFilter.value = '';
return;
}
const subs = [...new Set(
allVideos.filter(v => (v.category || "Uncategorized").trim() === cat).map(v => (v.subcategory || "").trim()).filter(Boolean)
)].sort();
subs.forEach(sub => {
const opt = document.createElement('option');
opt.value = sub;
opt.textContent = sub;
subcategoryFilter.appendChild(opt);
});
if (currentSubValue && subs.includes(currentSubValue)) {
subcategoryFilter.value = currentSubValue;
} else {
subcategoryFilter.value = '';
}
updateTopics();
}

function updateTopics() {
const cat = categoryFilter.value.trim();
const sub = subcategoryFilter.value.trim();
const currentTopicValue = topicFilter.value;
topicFilter.innerHTML = '<option value="">All Topics</option>';
if (!cat || !sub) {
topicFilter.value = '';
return;
}
const topics = [...new Set(
allVideos.filter(v => (v.category || "Uncategorized").trim() === cat && (v.subcategory || "").trim() === sub).map(v => (v.topic || "").trim()).filter(Boolean)
)].sort();
topics.forEach(top => {
const opt = document.createElement('option');
opt.value = top;
opt.textContent = top;
topicFilter.appendChild(opt);
});
if (currentTopicValue && topics.includes(currentTopicValue)) {
topicFilter.value = currentTopicValue;
} else {
topicFilter.value = '';
}
}

// ============================================
// TOGGLE FIRST VIDEO ID FIELD
// ============================================
function toggleFirstVideoIdField(type, prefix) {
const group = prefix === 'new' ? newFirstVideoIdGroup : editFirstVideoIdGroup;
if (type === 'youtube-playlist') {
group.style.display = 'block';
} else {
group.style.display = 'none';
}
}

// ============================================
// CREATE VIDEO CARD
// ============================================
function createVideoCard(video) {
const card = document.createElement('div');
card.className = 'video-card';
const thumbUrl = getThumbnailUrl(video);
const meta = [video.category || '', video.subcategory, video.topic].filter(Boolean).join(' ‚Ä¢ ');
let thumbHtml = '';
if (thumbUrl) {
thumbHtml = `<img src="${thumbUrl}" alt="Thumbnail">`;
} else {
let iconClass = "fa-video";
if (video.type === "pdf") iconClass = "fa-file-pdf";
else if (video.type === "youtube") iconClass = "fa-youtube";
else if (video.type === "youtube-playlist") iconClass = "fa-list";
else iconClass = "fa-google-drive";
thumbHtml = `<div class="placeholder"><i class="fas ${iconClass}"></i></div>`;
}
const typeBadge = `<div class="type-badge ${getTypeClass(video.type)}"><i class="fas ${getTypeIcon(video.type)} me-1"></i>${getTypeBadge(video.type)}</div>`;
const adminActionsHtml = currentUser ? `
<div class="admin-actions">
<button class="admin-btn-action edit-btn" data-firestore-id="${video.firestoreId}" title="Edit video">
<i class="fas fa-edit"></i>
</button>
<button class="admin-btn-action delete-btn" data-firestore-id="${video.firestoreId}" title="Delete video">
<i class="fas fa-trash"></i>
</button>
</div>
` : '';
card.innerHTML = `
<div class="card-thumb">
${thumbHtml}
${typeBadge}
${video.protected ? `<div class="protected-badge"><i class="fas fa-lock"></i></div>` : ''}
${adminActionsHtml}
<div class="glow-effect"></div>
</div>
<div class="card-content">
<div class="card-title">${video.title}</div>
<div class="card-meta">${meta}</div>
</div>`;
if (currentUser) {
const deleteBtn = card.querySelector('.delete-btn');
if (deleteBtn) {
deleteBtn.addEventListener('click', async (e) => {
e.stopPropagation();
const firestoreId = deleteBtn.getAttribute('data-firestore-id');
const videoTitle = video.title;
if (confirm(`‚ö†Ô∏è Delete "${videoTitle}"?\nThis cannot be undone!`)) {
try {
console.log(`üóëÔ∏è Deleting Firestore ID: ${firestoreId}`);
await deleteDoc(doc(db, "videos", firestoreId));
console.log("‚úÖ Video deleted successfully!");
} catch (error) {
console.error("‚ùå Error deleting video:", error);
alert(`‚ùå Failed to delete: ${error.message}`);
}
}
});
}
const editBtn = card.querySelector('.edit-btn');
if (editBtn) {
editBtn.addEventListener('click', (e) => {
e.stopPropagation();
openEditModal(video);
});
}
}
if (thumbUrl) {
const img = card.querySelector('img');
img.onload = () => img.classList.add('loaded');
img.onerror = () => { img.style.display = 'none'; card.querySelector('.placeholder').style.display = 'flex'; };
}
card.addEventListener('click', () => openVideo(video));
return card;
}

// ============================================
// HELPER - GET TYPE ICON
// ============================================
function getTypeIcon(type) {
const icons = {
'youtube': 'fa-youtube',
'drive': 'fa-google-drive',
'pdf': 'fa-file-pdf',
'youtube-playlist': 'fa-list'
};
return icons[type] || 'fa-video';
}

// ============================================
// FILTERING & RENDERING
// ============================================
function applyFilters() {
let list = [...allVideos];
const cat = categoryFilter.value.trim();
const sub = subcategoryFilter.value.trim();
const top = topicFilter.value.trim();
const query = searchBox.value.trim().toLowerCase();
if (cat) list = list.filter(v => (v.category || "Uncategorized").trim() === cat);
if (sub) list = list.filter(v => (v.subcategory || "").trim() === sub);
if (top) list = list.filter(v => (v.topic || "").trim() === top);
if (query) {
list = list.filter(v =>
v.title.toLowerCase().includes(query) ||
(v.category && v.category.toLowerCase().includes(query)) ||
(v.subcategory && v.subcategory.toLowerCase().includes(query)) ||
(v.topic && v.topic.toLowerCase().includes(query))
);
}
filteredVideos = list;
currentPage = 1;
renderVideos();
}

function renderVideos() {
if (!allVideos.length) {
videoGrid.innerHTML = `<div class="empty-state"><i class="fas fa-inbox"></i><p>No videos found in database.</p></div>`;
paginationEl.innerHTML = '';
return;
}
const total = filteredVideos.length;
const totalPages = Math.max(1, Math.ceil(total / VIDEOS_PER_PAGE));
currentPage = Math.min(currentPage, totalPages);
const start = (currentPage - 1) * VIDEOS_PER_PAGE;
const pageVideos = filteredVideos.slice(start, start + VIDEOS_PER_PAGE);
videoGrid.innerHTML = '';
if (pageVideos.length === 0) {
videoGrid.innerHTML = `<div class="empty-state"><i class="fas fa-search"></i><p>No videos found.</p></div>`;
} else {
pageVideos.forEach(v => videoGrid.appendChild(createVideoCard(v)));
}
renderPagination(totalPages);
}

function renderPagination(totalPages) {
paginationEl.innerHTML = '';
if (totalPages <= 1) return;
const maxVisible = 5;
let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
let endPage = Math.min(totalPages, startPage + maxVisible - 1);
if (endPage - startPage + 1 < maxVisible) startPage = Math.max(1, endPage - maxVisible + 1);
const prev = document.createElement('button');
prev.textContent = '¬´';
prev.disabled = currentPage === 1;
prev.onclick = () => { if (currentPage > 1) { currentPage--; renderVideos(); } };
paginationEl.appendChild(prev);
for (let i = startPage; i <= endPage; i++) {
const btn = document.createElement('button');
btn.textContent = i;
if (i === currentPage) btn.classList.add('active');
btn.onclick = () => { currentPage = i; renderVideos(); };
paginationEl.appendChild(btn);
}
const next = document.createElement('button');
next.textContent = '¬ª';
next.disabled = currentPage === totalPages;
next.onclick = () => { if (currentPage < totalPages) { currentPage++; renderVideos(); } };
paginationEl.appendChild(next);
}

// ============================================
// VIDEO PLAYBACK
// ============================================
function openVideo(video) {
if (video.protected) {
currentVideo = video;
passwordModal.style.display = 'flex';
videoPasswordInput.value = '';
passwordError.style.display = 'none';
videoPasswordInput.focus();
} else {
playInPopup(video);
}
}

function playInPopup(video) {
const url = getEmbedUrl(video);
if (!url) { alert("Content not available."); return; }
popupTitle.textContent = video.title;
popupFrame.src = url;
popupModal.style.display = 'flex';
}

function validatePassword() {
if (videoPasswordInput.value === videoPassword) {
passwordModal.style.display = 'none';
if (currentVideo) { playInPopup(currentVideo); currentVideo = null; }
} else {
passwordError.style.display = 'block';
setTimeout(() => passwordError.style.display = 'none', 2000);
}
}

// ============================================
// AUTHENTICATION
// ============================================
function openAuthModal() {
authModal.style.display = 'flex';
authError.style.display = 'none';
authError.textContent = '';
authEmail.value = '';
authPassword.value = '';
authEmail.focus();
}

function handleAuth(e) {
e.preventDefault();
const email = authEmail.value.trim();
const password = authPassword.value;
authError.style.display = 'none';
authSubmitBtn.disabled = true;
authSubmitBtn.textContent = 'Logging in...';
signInWithEmailAndPassword(auth, email, password)
.then((userCredential) => {
console.log("‚úÖ Logged in:", userCredential.user.email);
authModal.style.display = 'none';
})
.catch((error) => {
authError.textContent = "Error: " + error.message;
authError.style.display = 'block';
authSubmitBtn.disabled = false;
authSubmitBtn.textContent = 'Login';
});
}

function handleLogout() {
signOut(auth).then(() => { console.log("üëã Logged out"); }).catch((error) => { console.error(error); });
}

// ============================================
// ADD VIDEO
// ============================================
adminBtn.addEventListener('click', () => {
if (currentUser) {
addVideoModal.style.display = 'flex';
updateDataLists();
toggleFirstVideoIdField(newTypeSelect.value, 'new');
}
});

cancelAddVideo.addEventListener('click', () => {
addVideoModal.style.display = 'none';
addVideoForm.reset();
addVideoStatus.textContent = '';
toggleFirstVideoIdField('youtube', 'new');
});

newTypeSelect.addEventListener('change', () => toggleFirstVideoIdField(newTypeSelect.value, 'new'));
editTypeSelect.addEventListener('change', () => toggleFirstVideoIdField(editTypeSelect.value, 'edit'));

addVideoForm.addEventListener('submit', async (e) => {
e.preventDefault();
if (!db || !currentUser) { alert("Not authenticated"); return; }
const btn = e.target.querySelector('button[type="submit"]');
const originalText = btn.textContent;
btn.disabled = true;
btn.textContent = "Saving...";
addVideoStatus.textContent = "";
const newVideo = {
title: document.getElementById('newTitle').value,
type: document.getElementById('newType').value,
id: document.getElementById('newId').value,
url: document.getElementById('newId').value,
firstVideoId: document.getElementById('newFirstVideoId').value.trim(),
category: document.getElementById('newCategory').value,
subcategory: document.getElementById('newSubcategory').value,
topic: document.getElementById('newTopic').value,
protected: document.getElementById('newProtected').checked,
createdAt: serverTimestamp(),
addedBy: currentUser.email
};
try {
await addDoc(collection(db, "videos"), newVideo);
addVideoStatus.textContent = "‚úÖ Video added successfully!";
addVideoStatus.className = "status-success";
addVideoForm.reset();
toggleFirstVideoIdField('youtube', 'new');
setTimeout(() => { addVideoModal.style.display = 'none'; addVideoStatus.textContent = ""; }, 1500);
} catch (error) {
console.error("Error adding document: ", error);
addVideoStatus.textContent = "‚ùå Error: " + error.message;
addVideoStatus.className = "status-error";
} finally {
btn.disabled = false;
btn.textContent = originalText;
}
});

// ============================================
// EDIT VIDEO
// ============================================
function openEditModal(video) {
editingVideoId = video.firestoreId;
document.getElementById('editVideoId').value = video.firestoreId;
document.getElementById('editTitle').value = video.title;
document.getElementById('editType').value = video.type;
document.getElementById('editId').value = video.id || video.url;
document.getElementById('editFirstVideoId').value = video.firstVideoId || '';
document.getElementById('editCategory').value = video.category || '';
document.getElementById('editSubcategory').value = video.subcategory || '';
document.getElementById('editTopic').value = video.topic || '';
document.getElementById('editProtected').checked = video.protected || false;
editVideoStatus.textContent = '';
toggleFirstVideoIdField(video.type, 'edit');
editVideoModal.style.display = 'flex';
}

cancelEditVideo.addEventListener('click', () => {
editVideoModal.style.display = 'none';
editingVideoId = null;
editVideoStatus.textContent = '';
});

editVideoForm.addEventListener('submit', async (e) => {
e.preventDefault();
if (!db || !currentUser || !editingVideoId) { alert("Not authenticated or no video selected"); return; }
const btn = e.target.querySelector('button[type="submit"]');
const originalText = btn.textContent;
btn.disabled = true;
btn.textContent = "Updating...";
editVideoStatus.textContent = "";
const updatedVideo = {
title: document.getElementById('editTitle').value,
type: document.getElementById('editType').value,
id: document.getElementById('editId').value,
url: document.getElementById('editId').value,
firstVideoId: document.getElementById('editFirstVideoId').value.trim(),
category: document.getElementById('editCategory').value,
subcategory: document.getElementById('editSubcategory').value,
topic: document.getElementById('editTopic').value,
protected: document.getElementById('editProtected').checked,
updatedAt: serverTimestamp(),
updatedBy: currentUser.email
};
try {
console.log(`‚úèÔ∏è Updating Firestore ID: ${editingVideoId}`);
await updateDoc(doc(db, "videos", editingVideoId), updatedVideo);
console.log("‚úÖ Video updated successfully!");
editVideoStatus.textContent = "‚úÖ Video updated successfully!";
editVideoStatus.className = "status-success";
setTimeout(() => { editVideoModal.style.display = 'none'; editVideoStatus.textContent = ""; editingVideoId = null; }, 1500);
} catch (error) {
console.error("Error updating document: ", error);
editVideoStatus.textContent = "‚ùå Error: " + error.message;
editVideoStatus.className = "status-error";
} finally {
btn.disabled = false;
btn.textContent = originalText;
}
});

// ============================================
// ‚öôÔ∏è SETTINGS - CHANGE VIDEO PASSWORD
// ============================================
settingsBtn.addEventListener('click', () => {
if (currentUser) {
currentVideoPassword.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
newVideoPassword.value = '';
confirmVideoPassword.value = '';
settingsStatus.textContent = '';
settingsModal.style.display = 'flex';
}
});

cancelSettings.addEventListener('click', () => {
settingsModal.style.display = 'none';
settingsStatus.textContent = '';
});

settingsForm.addEventListener('submit', async (e) => {
e.preventDefault();
if (!db || !currentUser) {
alert("Not authenticated");
return;
}
const btn = e.target.querySelector('button[type="submit"]');
const originalText = btn.textContent;
btn.disabled = true;
btn.textContent = "Updating...";
settingsStatus.textContent = "";
const newPassword = newVideoPassword.value.trim();
const confirmPassword = confirmVideoPassword.value.trim();
if (!newPassword) {
settingsStatus.textContent = "‚ùå Password cannot be empty";
settingsStatus.className = "status-error";
btn.disabled = false;
btn.textContent = originalText;
return;
}
if (newPassword.length < 4) {
settingsStatus.textContent = "‚ùå Password must be at least 4 characters";
settingsStatus.className = "status-error";
btn.disabled = false;
btn.textContent = originalText;
return;
}
if (newPassword !== confirmPassword) {
settingsStatus.textContent = "‚ùå Passwords do not match";
settingsStatus.className = "status-error";
btn.disabled = false;
btn.textContent = originalText;
return;
}
try {
const passwordDoc = doc(db, "settings", "videoPassword");
await updateDoc(passwordDoc, {
password: newPassword,
updatedAt: serverTimestamp(),
updatedBy: currentUser.email
});
console.log("‚úÖ Video password updated successfully!");
settingsStatus.textContent = "‚úÖ Video password updated successfully!";
settingsStatus.className = "status-success";
videoPassword = newPassword;
setTimeout(() => {
settingsModal.style.display = 'none';
settingsStatus.textContent = "";
}, 2000);
} catch (error) {
console.error("Error updating password: ", error);
if (error.code === 'not-found') {
try {
await setDoc(doc(db, "settings", "videoPassword"), {
password: newPassword,
createdAt: serverTimestamp(),
createdBy: currentUser.email
});
settingsStatus.textContent = "‚úÖ Video password created successfully!";
settingsStatus.className = "status-success";
videoPassword = newPassword;
setTimeout(() => { settingsModal.style.display = 'none'; settingsStatus.textContent = ""; }, 2000);
} catch (createError) {
settingsStatus.textContent = "‚ùå Error: " + createError.message;
settingsStatus.className = "status-error";
}
} else {
settingsStatus.textContent = "‚ùå Error: " + error.message;
settingsStatus.className = "status-error";
}
} finally {
btn.disabled = false;
btn.textContent = originalText;
}
});

// ============================================
// EVENT LISTENERS
// ============================================
authBtn.addEventListener('click', () => { if (currentUser) { handleLogout(); } else { openAuthModal(); } });
authForm.addEventListener('submit', handleAuth);
cancelAuth.addEventListener('click', () => { authModal.style.display = 'none'; });
categoryFilter.addEventListener('change', () => { updateSubcategories(); updateTopics(); applyFilters(); });
subcategoryFilter.addEventListener('change', () => { updateTopics(); applyFilters(); });
topicFilter.addEventListener('change', () => { applyFilters(); });
searchBox.addEventListener('input', () => { applyFilters(); });
headerTitle.addEventListener('click', () => {
categoryFilter.value = ''; subcategoryFilter.value = ''; topicFilter.value = ''; searchBox.value = '';
updateSubcategories(); updateTopics(); applyFilters();
popupModal.style.display = 'none'; popupFrame.src = '';
});
closePopup.addEventListener('click', () => { popupModal.style.display = 'none'; popupFrame.src = ''; });
backToListBtn.addEventListener('click', () => { popupModal.style.display = 'none'; popupFrame.src = ''; });
document.addEventListener('keydown', (e) => {
if (e.key === 'Escape') {
if (passwordModal.style.display === 'flex') passwordModal.style.display = 'none';
else if (popupModal.style.display === 'flex') { popupModal.style.display = 'none'; popupFrame.src = ''; }
else if (addVideoModal.style.display === 'flex') addVideoModal.style.display = 'none';
else if (editVideoModal.style.display === 'flex') editVideoModal.style.display = 'none';
else if (settingsModal.style.display === 'flex') settingsModal.style.display = 'none';
else if (authModal.style.display === 'flex') authModal.style.display = 'none';
}
});
submitPassword.addEventListener('click', validatePassword);
videoPasswordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') validatePassword(); });
cancelPassword.addEventListener('click', () => { passwordModal.style.display = 'none'; currentVideo = null; });
</script>
</body>
</html>
